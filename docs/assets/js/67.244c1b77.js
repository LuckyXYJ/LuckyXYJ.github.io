(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{367:function(a,e,t){"use strict";t.r(e);var s=t(6),l=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h2",{attrs:{id:"链接动态库-dylib生成可执行文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#链接动态库-dylib生成可执行文件"}},[a._v("#")]),a._v(" 链接动态库.dylib生成可执行文件")]),a._v(" "),e("h3",{attrs:{id:"_1、将-m文件编译生成-o文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、将-m文件编译生成-o文件"}},[a._v("#")]),a._v(" 1、将.m文件编译生成.o文件")]),a._v(" "),e("p",[a._v("将test.m编译成test.o:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("clang -x objective-c \\\n-target x86_64-apple-macos11.1 \\\n-fobjc-arc \\\n-isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk \\\n-I./dylib \\\n-c test.m -o test.o\n")])])]),e("p",[a._v("将TestExample.m 编译成TestExample.o")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("clang -x objective-c \\\n-target x86_64-apple-macos11.1 \\\n-fobjc-arc \\\n-isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk \\\n-c TestExample.m -o TestExample.o\n")])])]),e("h3",{attrs:{id:"_2、-o文件生成dylib动态库文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、-o文件生成dylib动态库文件"}},[a._v("#")]),a._v(" 2、.o文件生成dylib动态库文件")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("clang -dynamiclib \\\n-target x86_64-apple-macos11.1 \\\n-fobjc-arc \\\n-isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk \\\nTestExample.o -o libTestExample.dylib\n")])])]),e("h3",{attrs:{id:"_3、-o文件链接动态库-生成可执行文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、-o文件链接动态库-生成可执行文件"}},[a._v("#")]),a._v(" 3、.o文件链接动态库，生成可执行文件")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("clang -target x86_64-apple-macos11.1 \\\n-fobjc-arc \\\n-isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk \\\n-L./dylib \\\n-lTestExample \\\ntest.o -o test\n")])])]),e("p",[a._v("此时生成的test可执行文件无法执行，因为找不到动态库")]),a._v(" "),e("h3",{attrs:{id:"_4、尝试操作-还是不行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、尝试操作-还是不行"}},[a._v("#")]),a._v(" 4、尝试操作，还是不行")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("libtool -static -arch_only x86_64 TestExample.o -o libTestExample.a\n\nld -dylib -arch x86_64 \\\n-macosx_version_min 11.1 \\\n-syslibroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk \\\n-lsystem -framework Foundation \\\n-ObjC \\\nlibTestExample.a -o libTestExample.dylib\n\nclang -target x86_64-apple-macos11.1 \\\n-fobjc-arc \\\n-isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk \\\n-L./dylib \\\n-lTestExample \\\ntest.o -o test\n")])])]),e("h5",{attrs:{id:"_5、寻找问题原因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、寻找问题原因"}},[a._v("#")]),a._v(" 5、寻找问题原因")]),a._v(" "),e("p",[a._v("使用otool 命令查看test文件mach-header信息")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("otool -l test | grep 'dylib' -A 3 -i\n")])])]),e("p",[a._v("​"),e("img",{attrs:{src:"http://xingyajie.oss-cn-hangzhou.aliyuncs.com/uPic/image-20221208105102189.png",alt:"image-20221208105102189"}}),a._v("​")]),a._v(" "),e("p",[a._v("从上图发现libTestExample.dylib与别的动态库区别是没有路径。")]),a._v(" "),e("p",[a._v("继续使用otool命令查看libTestExample.dylib文件")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("otool -l libTestExample.dylib | grep 'LC_ID_DYLIB' -A 5\n")])])]),e("p",[a._v("​"),e("img",{attrs:{src:"http://xingyajie.oss-cn-hangzhou.aliyuncs.com/uPic/image-20221208110048659.png",alt:"image-20221208110048659"}}),a._v("​")]),a._v(" "),e("p",[a._v("从这里的name可以看出，问题出现在动态库身上")]),a._v(" "),e("p",[a._v("可以之生成dylib文件时加入 -install_name来解决这问题")]),a._v(" "),e("h3",{attrs:{id:"_6、修改dylib文件install-name-或者在生成dylib文件时指定-install-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、修改dylib文件install-name-或者在生成dylib文件时指定-install-name"}},[a._v("#")]),a._v(" 6、修改dylib文件install_name，或者在生成dylib文件时指定 install_name")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("install_name_tool -id /Users/xyj/Documents/GitHub/ios_skill_tree/iOS进阶/动静态库原理/链接动态库.dylib文件/dylib/libTestExample.dylib libTestExample.dylib\n\n\nld -dylib -arch x86_64 \\\n-macosx_version_min 11.1 \\\n-syslibroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk \\\n-lsystem -framework Foundation \\\n-ObjC \\\n-install_name  /Users/xyj/Documents/GitHub/ios_skill_tree/iOS进阶/动静态库原理/链接动态库.dylib文件/dylib/libTestExample.dylib \\\nlibTestExample.a -o libTestExample.dylib\n")])])]),e("h3",{attrs:{id:"_7、重新生成test可执行文件-执行文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7、重新生成test可执行文件-执行文件"}},[a._v("#")]),a._v(" 7、重新生成test可执行文件，执行文件")]),a._v(" "),e("p",[a._v("此时能够成功执行文件，但是存在问题是，上一步指定路径是固定路径，换个路径就不行了")]),a._v(" "),e("p",[a._v("使用RPATH对其进行优化")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("install_name_tool -id @rpath/dylib/libTestExample.dylib libTestExample.dylib\n\ninstall_name_tool -add_rpath /Users/xyj/Documents/GitHub/ios_skill_tree/iOS进阶/动静态库原理/链接动态库.dylib文件 test\n")])])]),e("p",[a._v("以上给test添加rpath为绝对路径，依然无法移动文件。可以使用executable_path进行优化")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("install_name_tool -add_rpath @executable_path  test\n")])])]),e("h2",{attrs:{id:"xcode工程中链接动态库-弱引用链接动态库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xcode工程中链接动态库-弱引用链接动态库"}},[a._v("#")]),a._v(" xcode工程中链接动态库，弱引用链接动态库")]),a._v(" "),e("p",[a._v("在xcconfig中设置几个属性：")]),a._v(" "),e("ul",[e("li",[a._v("FRAMEWORK_SEARCH_PATHS： -F ，frmaework 所在的目录")]),a._v(" "),e("li",[a._v("HEADER_SEARCH_PATHS： -I ：头文件")]),a._v(" "),e("li",[a._v("LD_RUNPATH_SEARCH_PATHS： 静态库路径")]),a._v(" "),e("li",[a._v("OTHER_LDFLAGS： 静态库名称")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('// 2. -F: frmaework 所在的目录\nFRAMEWORK_SEARCH_PATHS = $(inherited) ${SRCROOT}\n// 1. -I ：头文件\nHEADER_SEARCH_PATHS = $(inherited) ${SRCROOT}/SYTimer.framework/Headers\n// 指定 rpath\nLD_RUNPATH_SEARCH_PATHS = $(inherited) ${SRCROOT}\n// 3. 名称\nOTHER_LDFLAGS = $(inherited) -Xlinker -weak_framework -Xlinker "SYTimer" \n//OTHER_LDFLAGS = $(inherited) -framework "SYTimer"\n')])])]),e("p",[e("strong",[a._v("-weak_framework")]),a._v(" 表示弱引用动态库，设置弱引用后，运行时若找不到动态库实现，则自动置为nil")])])}),[],!1,null,null,null);e.default=l.exports}}]);